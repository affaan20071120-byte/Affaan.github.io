<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Scientific Calculator — Affaan (DEG/RAD, exact trig)</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet">
<style>
:root{
  --text:#e7e8ee; --muted:#b7bbd0;
  --card: rgba(255,255,255,0.05);
  --line: rgba(255,255,255,0.12);
  --bg1:#0b0f2a; --bg2:#2b0d3a;
  --gold:#ffd166;
}
*{ box-sizing:border-box }
body{
  margin:0; min-height:100vh; color:var(--text); font-family:Poppins,system-ui,Arial;
  display:flex; align-items:center; justify-content:center; padding:20px;
  background: radial-gradient(1200px 800px at 20% 10%, rgba(255,60,80,0.10), transparent 60%),
              radial-gradient(1000px 700px at 80% 30%, rgba(58,160,255,0.12), transparent 60%),
              linear-gradient(180deg, var(--bg1), var(--bg2));
}
.wrap{
  width:min(520px,96vw);
  background:var(--card); border:1px solid var(--line); border-radius:16px; padding:18px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.3);
}
h1{ margin:6px 6px 12px; font-size:clamp(20px,3.2vw,28px) }
p{ color:var(--muted); margin:8px 6px 12px; }
.display{
  width:100%; border:1px solid var(--line); border-radius:12px; padding:12px; margin-bottom:12px;
  background: rgba(0,0,0,0.3); font-size:20px; color:var(--gold); text-align:right; min-height:56px;
  box-shadow: inset 0 0 18px rgba(58,160,255,0.08), 0 0 14px rgba(0,0,0,0.4);
  overflow-wrap:anywhere;
}
.controls{ display:flex; gap:8px; align-items:center; justify-content:flex-end; margin-bottom:8px; }
.controls button{
  padding:8px 12px; border-radius:10px; border:1px solid var(--line); background:rgba(0,0,0,0.25);
  color:var(--gold); cursor:pointer; box-shadow: 0 0 12px var(--gold);
}
.grid{ display:grid; grid-template-columns: repeat(5, 1fr); gap:8px; }
button.key{
  padding:12px 10px; border-radius:12px; border:1px solid var(--line); background:rgba(0,0,0,0.25);
  color:var(--text); font-weight:600; cursor:pointer;
  box-shadow: 0 0 10px var(--gold), 0 0 14px rgba(255,255,255,0.06);
  transition: transform .12s ease, box-shadow .12s ease;
}
button.key:hover{ transform: translateY(-2px); box-shadow: 0 0 18px var(--gold); }
.wide{ grid-column: span 2; }
.equals{ grid-column: span 2; background: linear-gradient(90deg, rgba(255,210,102,0.06), rgba(255,210,102,0.02)); color:var(--gold); box-shadow: 0 0 14px var(--gold); }
#unitBtn{ grid-column: span 1; background: rgba(0,0,0,0.3); color:var(--gold); border:1px solid rgba(255,215,102,0.6); box-shadow: 0 0 12px rgba(255,210,102,0.85); }
.hint{ color:var(--muted); font-size:13px; margin-top:8px; text-align:center; }
code{ background: rgba(255,255,255,0.02); padding:2px 6px; border-radius:6px; color:var(--gold); }
</style>
</head>
<body>
<div class="wrap" role="application" aria-label="Scientific calculator">
  <h1>Scientific Calculator</h1>
  <p>Type trig as <code>sin(30)</code> (DEG) or <code>sin(5pi/4)</code> (RAD). Use Mode to toggle DEG/RAD. Click unit button to insert unit.</p>

  <div id="display" class="display" aria-live="polite"></div>

  <div class="controls">
    <button id="modeToggle" type="button">Mode: <strong id="modeLabel">DEG</strong></button>
    <button id="unitBtn" type="button">°</button>
  </div>

  <div class="grid" id="keys" aria-hidden="false"></div>
  <div class="hint">Examples: <code>sin(30)</code> → <strong>1/2</strong>, <code>cos(5pi/4)</code> → <strong>-1/√2</strong></div>
</div>

<script>
const keyList=['7','8','9','(',')','4','5','6','^','√','1','2','3','×','÷','0','.','+','-','=','sin','cos','tan','log','ln','π','e','x²','1/x','%','C','DEL','ANS','EXP','±'];
const keysContainer=document.getElementById('keys');
const display=document.getElementById('display');
let memoryAns=0;
let mode='deg';
const modeLabel=document.getElementById('modeLabel');
const modeToggle=document.getElementById('modeToggle');
const unitBtn=document.getElementById('unitBtn');

// create keys
function createKey(label){
  const b=document.createElement('button');
  b.type='button'; b.className='key'; b.textContent=label;
  if(label==='='||label==='C'||label==='DEL') b.classList.add('wide');
  if(label==='=') b.classList.add('equals');
  b.addEventListener('click',()=>press(label));
  return b;
}
keyList.forEach(l=>keysContainer.appendChild(createKey(l)));

// mode toggle
modeToggle.addEventListener('click',()=>{
  mode=(mode==='deg')?'rad':'deg';
  modeLabel.textContent=mode.toUpperCase();
  unitBtn.textContent=(mode==='deg')?'°':'rad';
});
unitBtn.addEventListener('click',()=>appendToDisplay((mode==='deg')?'°':'rad'));
function appendToDisplay(txt){ display.textContent+=txt; }

// helper functions
function nearlyEqual(a,b,eps=1e-12){ return Math.abs(a-b)<=eps; }
function rationalApprox(x,maxDen=48,tol=1e-10){
  for(let d=1; d<=maxDen; d++){
    const n=Math.round(x*d);
    if(nearlyEqual(x,n/d,tol)) return {n,d};
  }
  return null;
}
function fractionString(x){ const approx=rationalApprox(x); if(!approx) return Number(x).toPrecision(12); let {n,d}=approx; return (d===1?n:n+'/'+d); }

// canonicalize pi fractions
function canonicalizeRadicalPi(expr){
  if(typeof expr!=='string') expr=String(expr);
  let s=expr.replace(/\s+/g,'').replace(/PI/ig,'π').replace(/\*/g,'');
  if(/π/.test(s)){
    try{
      let sign=1; if(s[0]==='-'){sign=-1;s=s.slice(1);}
      s=s.replace(/^π/,'1π').replace(/([^\d])π/,'$11π');
      const m=s.match(/^(-?\d+)?π(?:\/(-?\d+))?$/i);
      if(m){
        let n=(m[1]===undefined||m[1]==='')?1:Number(m[1]);
        let d=(m[2]===undefined)?1:Number(m[2]);
        n*=sign;
        const gcd=(a,b)=>b?gcd(b,a%b):Math.abs(a);
        const g=gcd(n,d)||1; n/=g; d/=g;
        let frac=n/d; frac=((frac%2)+2)%2;
        const approx=rationalApprox(frac);
        if(!approx) return null;
        let {n:N,d:D}=approx; if(N===0) return '0'; if(N===D) return 'π';
        return (N===1?'π':N+'π')+(D===1?'':'/'+D);
      }
    }catch(e){return null;}
  } else {
    try{
      const js=expr.replace(/\^/g,'**').replace(/√\(/g,'Math.sqrt(').replace(/π/g,'Math.PI').replace(/pi/ig,'Math.PI');
      const val=Function('return ('+js+')')();
      if(!isFinite(val)) return null;
      const frac=val/Math.PI;
      const approx=rationalApprox(frac);
      if(!approx) return null;
      let {n,d}=approx; n=((n%(2*d))+2*d)%(2*d);
      if(n===0) return '0'; if(n===d) return 'π';
      return (n===1?'π':n+'π')+(d===1?'':'/'+d);
    }catch(e){return null;}
  }
  return null;
}

// exact trig lookup tables
const trigExact={
  deg:{
    0:{sin:'0',cos:'1',tan:'0'},30:{sin:'1/2',cos:'√3/2',tan:'1/√3'},45:{sin:'1/√2',cos:'1/√2',tan:'1'},
    60:{sin:'√3/2',cos:'1/2',tan:'√3'},90:{sin:'1',cos:'0',tan:'undefined'},120:{sin:'√3/2',cos:'-1/2',tan:'-√3'},
    135:{sin:'1/√2',cos:'-1/√2',tan:'-1'},150:{sin:'1/2',cos:'-√3/2',tan:'-1/√3'},180:{sin:'0',cos:'-1',tan:'0'},
    210:{sin:'-1/2',cos:'-√3/2',tan:'1/√3'},225:{sin:'-1/√2',cos:'-1/√2',tan:'1'},240:{sin:'-√3/2',cos:'-1/2',tan:'√3'},
    270:{sin:'-1',cos:'0',tan:'undefined'},300:{sin:'-√3/2',cos:'1/2',tan:'-√3'},315:{sin:'-1/√2',cos:'1/√2',tan:'-1'},
    330:{sin:'-1/2',cos:'√3/2',tan:'-1/√3'},360:{sin:'0',cos:'1',tan:'0'}
  },
  rad:{} // keep rad table empty; canonicalizeRadicalPi will handle
};

// try exact single trig
function tryExactTrigSingle(text){
  text=text.trim();
  const m=text.match(/^\s*(sin|cos|tan)\((.+)\)\s*$/i);
  if(!m) return {found:false};
  const fn=m[1].toLowerCase(); let argRaw=m[2].trim();
  let unit=mode; if(/°/.test(argRaw)) unit='deg'; else if(/\brad\b|\bπ\b|pi/i.test(argRaw)) unit='rad';
  if(unit==='deg'){
    argRaw=argRaw.replace(/°/g,''); let degVal;
    try{ degVal=Function('return ('+argRaw+')')(); }catch(e){return {found:false};}
    if(!isFinite(degVal)) return {found:false};
    let degNorm=((degVal%360)+360)%360; const rounded=Math.round(degNorm); if(nearlyEqual(degNorm,rounded,1e-10)) degNorm=rounded;
    if(trigExact.deg.hasOwnProperty(degNorm)) return {found:true,value:trigExact.deg[degNorm][fn]};
    return {found:false};
  } else {
    const key=canonicalizeRadicalPi(argRaw);
    if(key) return {found:true,value:key};
    return {found:false};
  }
}

// convert expression to JS
function toJS(expr){
  if(typeof expr!=='string') expr=String(expr);
  expr=expr.replace(/([0-9]+(?:\.[0-9]+)?)\s*°/g,'($1*Math.PI/180)');
  expr=expr.replace(/\bdeg\b/g,'*Math.PI/180');
  expr=expr.replace(/π/g,'Math.PI').replace(/\bpi\b/ig,'Math.PI');
  expr=expr.replace(/√\(/g,'Math.sqrt(');
  expr=expr.replace(/\^/g,'**');
  expr=expr.replace(/\brad\b/g,'');
  expr=expr.replace(/(sin|cos|tan)\(\s*([^\)]+?)\s*\)/g,(m,fn,arg)=>{
    arg=arg.replace(/°/g,'');
    if(mode==='deg') return `Math.${fn}(${arg}*Math.PI/180)`;
    return `Math.${fn}(${arg})`;
  });
  expr=expr.replace(/log\(/g,'Math.log10(').replace(/ln\(/g,'Math.log(');
  return expr;
}
function formatNumber(n){ if(!isFinite(n)) return String(n); return parseFloat(Number(n).toPrecision(12)).toString(); }

// evaluate
function evaluate(){
  const txt=display.textContent.trim(); if(!txt) return;
  const exact=tryExactTrigSingle(txt);
  if(exact.found){ display.textContent=exact.value; memoryAns=exact.value; return; }
  try{
    const js=toJS(txt);
    const val=Function('return ('+js+')')();
    if(!isFinite(val)){ display.textContent='Error'; return; }
    if(mode==='rad'){
      const frac=val/Math.PI; const approx=rationalApprox(frac);
      if(approx){ let {n,d}=approx; n=((n%(2*d))+2*d)%(2*d); if(n===0) display.textContent='0'; else if(n===d) display.textContent='π'; else display.textContent=(n===1?'π':n+'π')+(d===1?'':'/'+d); memoryAns=display.textContent; return; }
    }
    display.textContent=fractionString(val); memoryAns=display.textContent;
  }catch(e){display.textContent='Error';}
}

// key press
function press(key){
  if(key==='C'){ display.textContent=''; return; }
  if(key==='DEL'){ display.textContent=display.textContent.slice(0,-1); return; }
  if(key==='ANS'){ display.textContent+=String(memoryAns); return; }
  if(key==='π'){ display.textContent+='π'; return; }
  if(key==='e'){ display.textContent+='e'; return; }
  if(key==='x²'){ display.textContent+='^2'; return; }
  if(key==='1/x'){ display.textContent+='^-1'; return; }
  if(key==='EXP'){ display.textContent+='e^'; return; }
  if(key==='±'){ toggleSign(); return; }
  if(['sin','cos','tan','log','ln','√'].includes(key)){ display.textContent+=(key==='√'? '√(' : key+'('); return; }
  if(key==='×'){ display.textContent+='*'; return; }
  if(key==='÷'){ display.textContent+='/'; return; }
  if(key==='='){ evaluate(); return; }
  display.textContent+=key;
}

function toggleSign(){
  const s=display.textContent; const m=s.match(/(-?\d*\.?\d+)(?!.*\d)/);
  if(!m){ display.textContent+='-'; return; }
  const start=m.index; const end=start+m[0].length; const before=s.slice(0,start); const num=m[0]; const after=s.slice(end);
  const toggled=num.startsWith('-')?num.slice(1):'-'+num;
  display.textContent=before+toggled+after;
}

// keyboard support
document.addEventListener('keydown',(e)=>{
  const k=e.key;
  if((k>='0'&&k<='9')||k==='.'||k==='+'||k==='-'||k==='*'||k==='/'||k==='('||k===')'||k==='%'){ display.textContent+=k; e.preventDefault(); }
  else if(k==='Enter'){ evaluate(); e.preventDefault(); }
  else if(k==='Backspace'){ display.textContent=display.textContent.slice(0,-1); e.preventDefault(); }
});
</script>
</body>
</html>
